<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok Shop API æµ‹è¯•å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            text-align: center;
        }

        .header h1 {
            color: #333;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 14px;
        }

        .config-section {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .config-section h2 {
            color: #333;
            font-size: 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            color: #555;
            font-size: 14px;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            background: white;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            font-weight: 500;
            color: #555;
        }

        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .api-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .api-section h3 {
            color: #333;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .api-section p {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .response-area {
            margin-top: 20px;
            padding: 20px;
            background: #2d3748;
            color: #68d391;
            border-radius: 10px;
            max-height: 500px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
        }

        .response-area::-webkit-scrollbar {
            width: 8px;
        }

        .response-area::-webkit-scrollbar-track {
            background: #1a202c;
            border-radius: 10px;
        }

        .response-area::-webkit-scrollbar-thumb {
            background: #4a5568;
            border-radius: 10px;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .status-success {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-error {
            background: #fed7d7;
            color: #742a2a;
        }

        .status-info {
            background: #bee3f8;
            color: #2c5282;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .input-group input {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            min-height: 150px;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .info-box {
            background: #e6f2ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .info-box h4 {
            color: #1565c0;
            margin-bottom: 8px;
        }

        .info-box p {
            color: #424242;
            font-size: 13px;
            line-height: 1.6;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ TikTok Shop API æµ‹è¯•å·¥å…·</h1>
            <p>å¿«é€Ÿæµ‹è¯•æ‰€æœ‰TikTok Shop APIæ¥å£ | æ”¯æŒåº—é“ºæˆæƒã€äº§å“ç®¡ç†ã€è®¢å•ç®¡ç†</p>
        </div>

        <div class="config-section">
            <h2>âš™ï¸ é…ç½®ä¿¡æ¯</h2>
            <div class="config-grid">
                <div class="form-group">
                    <label>API Base URL</label>
                    <input type="text" id="apiBaseUrl" value="http://localhost:3000" placeholder="http://localhost:3000">
                </div>
                <div class="form-group">
                    <label>Access Token</label>
                    <input type="text" id="accessToken" placeholder="ä»æˆæƒå›è°ƒè·å–çš„access_token">
                </div>
                <div class="form-group">
                    <label>Shop Cipher</label>
                    <input type="text" id="shopCipher" placeholder="ä»åº—é“ºåˆ—è¡¨è·å–çš„cipher">
                </div>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('auth')">ğŸ” æˆæƒç®¡ç†</div>
            <div class="tab" onclick="switchTab('shop')">ğŸª åº—é“ºç®¡ç†</div>
            <div class="tab" onclick="switchTab('product')">ğŸ“¦ äº§å“ç®¡ç†</div>
            <div class="tab" onclick="switchTab('order')">ğŸ“‹ è®¢å•ç®¡ç†</div>
        </div>

        <!-- æˆæƒç®¡ç† Tab -->
        <div class="tab-content active" id="auth-tab">
            <div class="info-box">
                <h4>ğŸ“Œ ä½¿ç”¨è¯´æ˜</h4>
                <p>1. é¦–å…ˆç‚¹å‡»"è·å–æˆæƒé“¾æ¥"ï¼Œå¤åˆ¶é“¾æ¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€<br>
                   2. åœ¨TikTokæˆæƒé¡µé¢å®Œæˆæˆæƒ<br>
                   3. æˆæƒåä¼šé‡å®šå‘å›è°ƒURLï¼Œä»URLå‚æ•°ä¸­è·å–code<br>
                   4. å°†codeç²˜è´´åˆ°ä¸‹æ–¹è¾“å…¥æ¡†ï¼Œç‚¹å‡»"è·å–Token"</p>
            </div>

            <div class="api-section">
                <h3>1. è·å–æˆæƒé“¾æ¥</h3>
                <p>ç”ŸæˆTikTok Shopçš„OAuthæˆæƒé“¾æ¥</p>
                <button class="btn-primary" onclick="getAuthUrl()">è·å–æˆæƒé“¾æ¥</button>
            </div>

            <div class="api-section">
                <h3>2. é€šè¿‡æˆæƒç è·å–Token</h3>
                <p>ä½¿ç”¨æˆæƒå›è°ƒè·å¾—çš„codeæ¢å–access_token</p>
                <div class="input-group">
                    <input type="text" id="authCode" placeholder="è¾“å…¥æˆæƒç (code)">
                    <button class="btn-primary" onclick="getToken()">è·å–Token</button>
                </div>
            </div>

            <div class="api-section">
                <h3>3. åˆ·æ–°Token</h3>
                <p>ä½¿ç”¨refresh_tokenåˆ·æ–°access_tokenï¼ˆTokenæœ‰æ•ˆæœŸ7å¤©ï¼‰</p>
                <div class="input-group">
                    <input type="text" id="refreshToken" placeholder="è¾“å…¥refresh_token">
                    <button class="btn-warning" onclick="refreshToken()">åˆ·æ–°Token</button>
                </div>
            </div>

            <div class="response-area" id="auth-response">ç­‰å¾…APIå“åº”...</div>
        </div>

        <!-- åº—é“ºç®¡ç† Tab -->
        <div class="tab-content" id="shop-tab">
            <div class="info-box">
                <h4>ğŸ“Œ ä½¿ç”¨è¯´æ˜</h4>
                <p>éœ€è¦å…ˆè·å–Access Tokenã€‚ç‚¹å‡»"è·å–å·²æˆæƒåº—é“º"å¯ä»¥è·å–shop_cipherï¼Œè¿™æ˜¯åç»­äº§å“APIå¿…éœ€çš„å‚æ•°ã€‚</p>
            </div>

            <div class="api-section">
                <h3>1. è·å–å·²æˆæƒçš„åº—é“ºåˆ—è¡¨</h3>
                <p>è·å–å½“å‰access_tokenæˆæƒçš„æ‰€æœ‰åº—é“ºï¼Œ<strong>ä»è¿™é‡Œè·å–shop_cipher</strong></p>
                <button class="btn-primary" onclick="getAuthorizedShops()">è·å–å·²æˆæƒåº—é“º</button>
            </div>

            <div class="api-section">
                <h3>2. è·å–åº—é“ºè¯¦ç»†ä¿¡æ¯</h3>
                <p>è·å–åº—é“ºçš„è¯¦ç»†ä¿¡æ¯å’ŒçŠ¶æ€</p>
                <button class="btn-primary" onclick="getShopDetails()">è·å–åº—é“ºè¯¦æƒ…</button>
            </div>

            <div class="api-section">
                <h3>3. è·å–åº—é“ºæƒé™</h3>
                <p>æŸ¥çœ‹åº”ç”¨å¯¹åº—é“ºçš„æƒé™åˆ—è¡¨</p>
                <button class="btn-primary" onclick="getShopPermissions()">è·å–åº—é“ºæƒé™</button>
            </div>

            <div class="api-section">
                <h3>4. è·å–Widget Token</h3>
                <p>è·å–ç”¨äºå‰ç«¯é›†æˆçš„Widget Token</p>
                <div class="input-group">
                    <input type="text" id="widgetShopId" placeholder="åº—é“ºIDï¼ˆå¯é€‰ï¼‰">
                    <button class="btn-primary" onclick="getWidgetToken()">è·å–Widget Token</button>
                </div>
            </div>

            <div class="response-area" id="shop-response">ç­‰å¾…APIå“åº”...</div>
        </div>

        <!-- äº§å“ç®¡ç† Tab -->
        <div class="tab-content" id="product-tab">
            <div class="info-box">
                <h4>ğŸ“Œ ä½¿ç”¨è¯´æ˜</h4>
                <p>éœ€è¦å…ˆè·å–Access Tokenå’ŒShop Cipherã€‚æ‰€æœ‰äº§å“ç›¸å…³æ“ä½œéƒ½éœ€è¦è¿™ä¸¤ä¸ªå‚æ•°ã€‚</p>
            </div>

            <div class="api-section">
                <h3>1. æœç´¢äº§å“</h3>
                <p>æ ¹æ®æ¡ä»¶æœç´¢äº§å“ï¼Œæ”¯æŒåˆ†é¡µå’ŒçŠ¶æ€ç­›é€‰</p>
                <div class="button-group">
                    <button class="btn-primary" onclick="searchProducts()">æœç´¢æ‰€æœ‰äº§å“</button>
                    <button class="btn-success" onclick="searchProducts(4)">æœç´¢å·²æ¿€æ´»äº§å“</button>
                    <button class="btn-secondary" onclick="searchProducts(2)">æœç´¢è‰ç¨¿äº§å“</button>
                </div>
            </div>

            <div class="api-section">
                <h3>2. è·å–äº§å“è¯¦æƒ…</h3>
                <p>æ ¹æ®äº§å“IDè·å–è¯¦ç»†ä¿¡æ¯</p>
                <div class="input-group">
                    <input type="text" id="productId" placeholder="è¾“å…¥äº§å“ID">
                    <button class="btn-primary" onclick="getProductDetail()">è·å–äº§å“è¯¦æƒ…</button>
                </div>
            </div>

            <div class="api-section">
                <h3>3. åˆ›å»ºäº§å“</h3>
                <p>åˆ›å»ºæ–°äº§å“ï¼ˆéœ€è¦å®Œæ•´çš„äº§å“æ•°æ®JSONï¼‰</p>
                <textarea id="createProductData" placeholder='è¾“å…¥äº§å“JSONæ•°æ®ï¼Œä¾‹å¦‚ï¼š
{
  "title": "Test Product",
  "description": "Product description",
  "category_id": "703",
  "brand_id": "12345",
  "main_images": [{"uri": "image_uri"}],
  "skus": [{
    "seller_sku": "SKU001",
    "price": {"amount": "19.99", "currency": "USD"},
    "available_stock": 100
  }]
}'></textarea>
                <button class="btn-success" onclick="createProduct()">åˆ›å»ºäº§å“</button>
            </div>

            <div class="api-section">
                <h3>4. äº§å“ç®¡ç†æ“ä½œ</h3>
                <p>æ¿€æ´»ã€åœç”¨ã€åˆ é™¤äº§å“ï¼ˆè¾“å…¥äº§å“IDï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”ï¼‰</p>
                <div class="input-group">
                    <input type="text" id="manageProductIds" placeholder="äº§å“IDåˆ—è¡¨ï¼Œä¾‹å¦‚ï¼š123,456,789">
                </div>
                <div class="button-group">
                    <button class="btn-success" onclick="activateProducts()">æ¿€æ´»äº§å“ï¼ˆä¸Šæ¶ï¼‰</button>
                    <button class="btn-warning" onclick="deactivateProducts()">åœç”¨äº§å“ï¼ˆä¸‹æ¶ï¼‰</button>
                    <button class="btn-danger" onclick="deleteProducts()">åˆ é™¤äº§å“</button>
                </div>
            </div>

            <div class="api-section">
                <h3>5. æ›´æ–°åº“å­˜</h3>
                <p>æ›´æ–°äº§å“SKUçš„åº“å­˜æ•°é‡</p>
                <div class="input-group">
                    <input type="text" id="inventoryProductId" placeholder="äº§å“ID">
                    <input type="text" id="inventorySkuId" placeholder="SKU ID">
                    <input type="number" id="inventoryStock" placeholder="åº“å­˜æ•°é‡">
                    <button class="btn-primary" onclick="updateInventory()">æ›´æ–°åº“å­˜</button>
                </div>
            </div>

            <div class="api-section">
                <h3>6. æ›´æ–°ä»·æ ¼</h3>
                <p>æ›´æ–°äº§å“SKUçš„ä»·æ ¼</p>
                <div class="input-group">
                    <input type="text" id="priceProductId" placeholder="äº§å“ID">
                    <input type="text" id="priceSkuId" placeholder="SKU ID">
                    <input type="text" id="priceAmount" placeholder="ä»·æ ¼">
                    <button class="btn-primary" onclick="updatePrice()">æ›´æ–°ä»·æ ¼</button>
                </div>
            </div>

            <div class="api-section">
                <h3>7. è·å–åˆ†ç±»å’Œå“ç‰Œ</h3>
                <p>è·å–TikTok Shopçš„äº§å“åˆ†ç±»å’Œå“ç‰Œåˆ—è¡¨</p>
                <div class="button-group">
                    <button class="btn-primary" onclick="getCategories()">è·å–åˆ†ç±»åˆ—è¡¨</button>
                    <button class="btn-primary" onclick="getBrands()">è·å–å“ç‰Œåˆ—è¡¨</button>
                </div>
            </div>

            <div class="response-area" id="product-response">ç­‰å¾…APIå“åº”...</div>
        </div>

        <!-- è®¢å•ç®¡ç† Tab -->
        <div class="tab-content" id="order-tab">
            <div class="info-box">
                <h4>ğŸ“Œ ä½¿ç”¨è¯´æ˜</h4>
                <p>éœ€è¦å…ˆè·å–Access Tokenå’ŒShop Cipherã€‚å¯ä»¥æŒ‰çŠ¶æ€ç­›é€‰è®¢å•æˆ–æŒ‰æ—¶é—´èŒƒå›´æŸ¥è¯¢ã€‚</p>
            </div>

            <div class="api-section">
                <h3>1. æŒ‰çŠ¶æ€è·å–è®¢å•</h3>
                <p>å¿«é€Ÿè·å–ç‰¹å®šçŠ¶æ€çš„è®¢å•</p>
                <div class="button-group">
                    <button class="btn-warning" onclick="getPendingShipmentOrders()">å¾…å‘è´§è®¢å•</button>
                    <button class="btn-primary" onclick="getInTransitOrders()">è¿è¾“ä¸­è®¢å•</button>
                    <button class="btn-success" onclick="getCompletedOrders()">å·²å®Œæˆè®¢å•</button>
                </div>
            </div>

            <div class="api-section">
                <h3>2. è·å–è®¢å•è¯¦æƒ…</h3>
                <p>æ ¹æ®è®¢å•IDè·å–è¯¦ç»†ä¿¡æ¯</p>
                <div class="input-group">
                    <input type="text" id="orderId" placeholder="è¾“å…¥è®¢å•ID">
                    <button class="btn-primary" onclick="getOrderDetail()">è·å–è®¢å•è¯¦æƒ…</button>
                </div>
            </div>

            <div class="api-section">
                <h3>3. é«˜çº§æœç´¢è®¢å•</h3>
                <p>ä½¿ç”¨å®Œæ•´çš„æœç´¢æ¡ä»¶æŸ¥è¯¢è®¢å•</p>
                <textarea id="orderSearchData" placeholder='è¾“å…¥æœç´¢æ¡ä»¶JSONï¼Œä¾‹å¦‚ï¼š
{
  "shop_cipher": "your_shop_cipher",
  "page_number": 1,
  "page_size": 20,
  "order_status": [111, 112],
  "sort_by": "CREATE_TIME",
  "sort_order": "DESC"
}'></textarea>
                <button class="btn-primary" onclick="searchOrders()">æœç´¢è®¢å•</button>
            </div>

            <div class="api-section">
                <h3>4. è·å–æœ€è¿‘æ›´æ–°çš„è®¢å•</h3>
                <p>è·å–æœ€è¿‘Nåˆ†é’Ÿå†…æ›´æ–°çš„è®¢å•</p>
                <div class="input-group">
                    <input type="number" id="recentMinutes" placeholder="åˆ†é’Ÿæ•°" value="30">
                    <button class="btn-primary" onclick="getRecentlyUpdatedOrders()">è·å–æœ€è¿‘æ›´æ–°</button>
                </div>
            </div>

            <div class="response-area" id="order-response">ç­‰å¾…APIå“åº”...</div>
        </div>
    </div>

    <script>
        // å·¥å…·å‡½æ•°
        function getBaseUrl() {
            return document.getElementById('apiBaseUrl').value.trim() || 'http://localhost:3000';
        }

        function getAccessToken() {
            return document.getElementById('accessToken').value.trim();
        }

        function getShopCipher() {
            return document.getElementById('shopCipher').value.trim();
        }

        function showResponse(tabId, data, error = false) {
            const responseArea = document.getElementById(tabId + '-response');
            const timestamp = new Date().toLocaleTimeString();
            const statusClass = error ? 'status-error' : 'status-success';
            const statusText = error ? 'ERROR' : 'SUCCESS';

            responseArea.innerHTML = `
                <div style="margin-bottom: 10px;">
                    <span class="status-badge ${statusClass}">${statusText}</span>
                    <span style="margin-left: 10px; color: #a0aec0;">${timestamp}</span>
                </div>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
        }

        async function makeRequest(url, options = {}) {
            try {
                const response = await fetch(url, options);
                const data = await response.json();
                return { data, error: !response.ok };
            } catch (error) {
                return { data: { error: error.message }, error: true };
            }
        }

        function switchTab(tabName) {
            // åˆ‡æ¢tabæ ·å¼
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // åˆ‡æ¢å†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        // ========== æˆæƒç®¡ç† ==========
        async function getAuthUrl() {
            const url = `${getBaseUrl()}/auth/authorization-url`;
            const { data, error } = await makeRequest(url);

            if (!error && data.data) {
                const authUrl = data.data.authorization_url;
                showResponse('auth', {
                    ...data,
                    message: 'âœ… è¯·å¤åˆ¶ä¸‹é¢çš„é“¾æ¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€è¿›è¡Œæˆæƒ',
                    authorization_url: authUrl
                });

                // è‡ªåŠ¨å¤åˆ¶åˆ°å‰ªè´´æ¿
                navigator.clipboard.writeText(authUrl).then(() => {
                    alert('æˆæƒé“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\n\n' + authUrl);
                });
            } else {
                showResponse('auth', data, true);
            }
        }

        async function getToken() {
            const authCode = document.getElementById('authCode').value.trim();
            if (!authCode) {
                alert('è¯·è¾“å…¥æˆæƒç ');
                return;
            }

            const url = `${getBaseUrl()}/auth/callback?code=${authCode}`;
            const { data, error } = await makeRequest(url);

            if (!error && data.data) {
                // è‡ªåŠ¨å¡«å……token
                document.getElementById('accessToken').value = data.data.access_token;
                showResponse('auth', {
                    ...data,
                    message: 'âœ… Tokenå·²è‡ªåŠ¨å¡«å……åˆ°é…ç½®åŒºåŸŸ'
                });
            } else {
                showResponse('auth', data, true);
            }
        }

        async function refreshToken() {
            const refreshToken = document.getElementById('refreshToken').value.trim();
            if (!refreshToken) {
                alert('è¯·è¾“å…¥refresh_token');
                return;
            }

            const url = `${getBaseUrl()}/auth/refresh`;
            const { data, error } = await makeRequest(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ refresh_token: refreshToken })
            });

            if (!error && data.data) {
                document.getElementById('accessToken').value = data.data.access_token;
                showResponse('auth', {
                    ...data,
                    message: 'âœ… Tokenå·²åˆ·æ–°å¹¶è‡ªåŠ¨å¡«å……'
                });
            } else {
                showResponse('auth', data, true);
            }
        }

        // ========== åº—é“ºç®¡ç† ==========
        async function getAuthorizedShops() {
            const token = getAccessToken();
            if (!token) {
                alert('è¯·å…ˆå¡«å†™Access Token');
                return;
            }

            const url = `${getBaseUrl()}/shops/authorized`;
            const { data, error } = await makeRequest(url, {
                headers: { 'Authorization': `Bearer ${token}` }
            });

            if (!error && data.data && data.data.shops && data.data.shops.length > 0) {
                // è‡ªåŠ¨å¡«å……ç¬¬ä¸€ä¸ªåº—é“ºçš„cipher
                document.getElementById('shopCipher').value = data.data.shops[0].cipher;
                showResponse('shop', {
                    ...data,
                    message: 'âœ… Shop Cipherå·²è‡ªåŠ¨å¡«å……åˆ°é…ç½®åŒºåŸŸ'
                });
            } else {
                showResponse('shop', data, error);
            }
        }

        async function getShopDetails() {
            const token = getAccessToken();
            if (!token) {
                alert('è¯·å…ˆå¡«å†™Access Token');
                return;
            }

            const url = `${getBaseUrl()}/shops/details`;
            const { data, error } = await makeRequest(url, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            showResponse('shop', data, error);
        }

        async function getShopPermissions() {
            const token = getAccessToken();
            if (!token) {
                alert('è¯·å…ˆå¡«å†™Access Token');
                return;
            }

            const url = `${getBaseUrl()}/shops/permissions`;
            const { data, error } = await makeRequest(url, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            showResponse('shop', data, error);
        }

        async function getWidgetToken() {
            const token = getAccessToken();
            const shopId = document.getElementById('widgetShopId').value.trim();

            if (!token) {
                alert('è¯·å…ˆå¡«å†™Access Token');
                return;
            }

            const url = `${getBaseUrl()}/shops/widget-token${shopId ? '?shop_id=' + shopId : ''}`;
            const { data, error } = await makeRequest(url, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            showResponse('shop', data, error);
        }

        // ========== äº§å“ç®¡ç† ==========
        async function searchProducts(status) {
            const token = getAccessToken();
            const cipher = getShopCipher();

            if (!token || !cipher) {
                alert('è¯·å…ˆå¡«å†™Access Tokenå’ŒShop Cipher');
                return;
            }

            const searchData = {
                page_number: 1,
                page_size: 20
            };

            if (status) {
                searchData.search_status = status;
            }

            const url = `${getBaseUrl()}/products/search`;
            const { data, error } = await makeRequest(url, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'X-Shop-Cipher': cipher,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(searchData)
            });
            showResponse('product', data, error);
        }

        async function getProductDetail() {
            const token = getAccessToken();
            const cipher = getShopCipher();
            const productId = document.getElementById('productId').value.trim();

            if (!token || !cipher || !productId) {
                alert('è¯·å…ˆå¡«å†™Access Tokenã€Shop Cipherå’Œäº§å“ID');
                return;
            }

            const url = `${getBaseUrl()}/products/${productId}`;
            const { data, error } = await makeRequest(url, {
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'X-Shop-Cipher': cipher
                }
            });
            showResponse('product', data, error);
        }

        async function createProduct() {
            const token = getAccessToken();
            const cipher = getShopCipher();
            const productDataStr = document.getElementById('createProductData').value.trim();

            if (!token || !cipher || !productDataStr) {
                alert('è¯·å…ˆå¡«å†™æ‰€æœ‰å¿…éœ€ä¿¡æ¯');
                return;
            }

            let productData;
            try {
                productData = JSON.parse(productDataStr);
            } catch (e) {
                alert('äº§å“æ•°æ®JSONæ ¼å¼é”™è¯¯');
                return;
            }

            const url = `${getBaseUrl()}/products`;
            const { data, error } = await makeRequest(url, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'X-Shop-Cipher': cipher,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(productData)
            });
            showResponse('product', data, error);
        }

        async function activateProducts() {
            await manageProducts('activate');
        }

        async function deactivateProducts() {
            await manageProducts('deactivate');
        }

        async function deleteProducts() {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™äº›äº§å“å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                return;
            }
            await manageProducts('delete');
        }

        async function manageProducts(action) {
            const token = getAccessToken();
            const cipher = getShopCipher();
            const productIdsStr = document.getElementById('manageProductIds').value.trim();

            if (!token || !cipher || !productIdsStr) {
                alert('è¯·å…ˆå¡«å†™æ‰€æœ‰å¿…éœ€ä¿¡æ¯');
                return;
            }

            const productIds = productIdsStr.split(',').map(id => id.trim()).filter(id => id);

            let url, method;
            if (action === 'delete') {
                url = `${getBaseUrl()}/products`;
                method = 'DELETE';
            } else {
                url = `${getBaseUrl()}/products/${action}`;
                method = 'POST';
            }

            const { data, error } = await makeRequest(url, {
                method: method,
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'X-Shop-Cipher': cipher,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ product_ids: productIds })
            });
            showResponse('product', data, error);
        }

        async function updateInventory() {
            const token = getAccessToken();
            const cipher = getShopCipher();
            const productId = document.getElementById('inventoryProductId').value.trim();
            const skuId = document.getElementById('inventorySkuId').value.trim();
            const stock = document.getElementById('inventoryStock').value.trim();

            if (!token || !cipher || !productId || !skuId || !stock) {
                alert('è¯·å…ˆå¡«å†™æ‰€æœ‰å¿…éœ€ä¿¡æ¯');
                return;
            }

            const url = `${getBaseUrl()}/products/${productId}/inventory`;
            const { data, error } = await makeRequest(url, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'X-Shop-Cipher': cipher,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    skus: [{ id: skuId, available_stock: parseInt(stock) }]
                })
            });
            showResponse('product', data, error);
        }

        async function updatePrice() {
            const token = getAccessToken();
            const cipher = getShopCipher();
            const productId = document.getElementById('priceProductId').value.trim();
            const skuId = document.getElementById('priceSkuId').value.trim();
            const amount = document.getElementById('priceAmount').value.trim();

            if (!token || !cipher || !productId || !skuId || !amount) {
                alert('è¯·å…ˆå¡«å†™æ‰€æœ‰å¿…éœ€ä¿¡æ¯');
                return;
            }

            const url = `${getBaseUrl()}/products/${productId}/price`;
            const { data, error } = await makeRequest(url, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'X-Shop-Cipher': cipher,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    skus: [{ id: skuId, price: { amount: amount, currency: 'USD' } }]
                })
            });
            showResponse('product', data, error);
        }

        async function getCategories() {
            const token = getAccessToken();
            const cipher = getShopCipher();

            if (!token || !cipher) {
                alert('è¯·å…ˆå¡«å†™Access Tokenå’ŒShop Cipher');
                return;
            }

            const url = `${getBaseUrl()}/products/metadata/categories`;
            const { data, error } = await makeRequest(url, {
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'X-Shop-Cipher': cipher
                }
            });
            showResponse('product', data, error);
        }

        async function getBrands() {
            const token = getAccessToken();
            const cipher = getShopCipher();

            if (!token || !cipher) {
                alert('è¯·å…ˆå¡«å†™Access Tokenå’ŒShop Cipher');
                return;
            }

            const url = `${getBaseUrl()}/products/metadata/brands`;
            const { data, error } = await makeRequest(url, {
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'X-Shop-Cipher': cipher
                }
            });
            showResponse('product', data, error);
        }

        // ========== è®¢å•ç®¡ç† ==========
        async function getPendingShipmentOrders() {
            await getOrdersByStatus('pending-shipment');
        }

        async function getInTransitOrders() {
            await getOrdersByStatus('in-transit');
        }

        async function getCompletedOrders() {
            await getOrdersByStatus('completed');
        }

        async function getOrdersByStatus(status) {
            const token = getAccessToken();
            const cipher = getShopCipher();

            if (!token || !cipher) {
                alert('è¯·å…ˆå¡«å†™Access Tokenå’ŒShop Cipher');
                return;
            }

            const url = `${getBaseUrl()}/orders/status/${status}?page=1&page_size=20`;
            const { data, error } = await makeRequest(url, {
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'X-Shop-Cipher': cipher
                }
            });
            showResponse('order', data, error);
        }

        async function getOrderDetail() {
            const token = getAccessToken();
            const orderId = document.getElementById('orderId').value.trim();

            if (!token || !orderId) {
                alert('è¯·å…ˆå¡«å†™Access Tokenå’Œè®¢å•ID');
                return;
            }

            const url = `${getBaseUrl()}/orders/${orderId}`;
            const { data, error } = await makeRequest(url, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            showResponse('order', data, error);
        }

        async function searchOrders() {
            const token = getAccessToken();
            const searchDataStr = document.getElementById('orderSearchData').value.trim();

            if (!token || !searchDataStr) {
                alert('è¯·å…ˆå¡«å†™æ‰€æœ‰å¿…éœ€ä¿¡æ¯');
                return;
            }

            let searchData;
            try {
                searchData = JSON.parse(searchDataStr);
            } catch (e) {
                alert('æœç´¢æ¡ä»¶JSONæ ¼å¼é”™è¯¯');
                return;
            }

            const url = `${getBaseUrl()}/orders/search`;
            const { data, error } = await makeRequest(url, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(searchData)
            });
            showResponse('order', data, error);
        }

        async function getRecentlyUpdatedOrders() {
            const token = getAccessToken();
            const cipher = getShopCipher();
            const minutes = document.getElementById('recentMinutes').value.trim() || '30';

            if (!token || !cipher) {
                alert('è¯·å…ˆå¡«å†™Access Tokenå’ŒShop Cipher');
                return;
            }

            const url = `${getBaseUrl()}/orders/filters/recently-updated?minutes=${minutes}`;
            const { data, error } = await makeRequest(url, {
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'X-Shop-Cipher': cipher
                }
            });
            showResponse('order', data, error);
        }

        // é¡µé¢åŠ è½½å®Œæˆæç¤º
        console.log('%cğŸš€ TikTok Shop API æµ‹è¯•å·¥å…·å·²å°±ç»ªï¼', 'font-size: 20px; color: #667eea; font-weight: bold;');
        console.log('ä½¿ç”¨æç¤ºï¼š\n1. ç¡®ä¿åç«¯æœåŠ¡å·²å¯åŠ¨ (pnpm run start:dev)\n2. ä»æˆæƒæµç¨‹å¼€å§‹è·å–Token\n3. è·å–Shop Cipheråå³å¯æµ‹è¯•äº§å“å’Œè®¢å•API');
    </script>
</body>
</html>
