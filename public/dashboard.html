<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok Shop API æµ‹è¯•ä»ªè¡¨æ¿</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-left h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header-left p {
            color: #666;
            font-size: 14px;
        }

        .auth-status {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .auth-item {
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }

        .auth-item h4 {
            color: #333;
            font-size: 12px;
            margin-bottom: 3px;
        }

        .auth-item p {
            color: #666;
            font-size: 11px;
            word-break: break-all;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            background: white;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            font-weight: 500;
            color: #555;
        }

        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .api-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .api-section h3 {
            color: #333;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .api-section p {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .response-area {
            margin-top: 20px;
            padding: 20px;
            background: #2d3748;
            color: #68d391;
            border-radius: 10px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            position: sticky;
            top: 10px;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            border: 2px solid #4a5568;
        }

        .response-area::-webkit-scrollbar {
            width: 8px;
        }

        .response-area::-webkit-scrollbar-track {
            background: #1a202c;
            border-radius: 10px;
        }

        .response-area::-webkit-scrollbar-thumb {
            background: #4a5568;
            border-radius: 10px;
        }

        .response-area::-webkit-scrollbar-thumb:hover {
            background: #718096;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .status-success {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-error {
            background: #fed7d7;
            color: #742a2a;
        }

        .status-info {
            background: #bee3f8;
            color: #2c5282;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .input-group input {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            min-height: 150px;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .info-box {
            background: #e6f2ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .info-box h4 {
            color: #1565c0;
            margin-bottom: 8px;
        }

        .info-box p {
            color: #424242;
            font-size: 13px;
            line-height: 1.6;
        }

        .config-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .config-form h3 {
            color: #333;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            color: #555;
            font-size: 14px;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .navigation {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn-restart {
            background: #ffc107;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <h1>ğŸš€ TikTok Shop API æµ‹è¯•ä»ªè¡¨æ¿</h1>
                <p>å¿«é€Ÿæµ‹è¯•æ‰€æœ‰TikTok Shop APIæ¥å£</p>
            </div>
            <div class="auth-status">
                <div class="auth-item">
                    <h4>Access Token</h4>
                    <p id="statusToken">æœªè®¾ç½®</p>
                </div>
                <div class="auth-item">
                    <h4>Shop Cipher</h4>
                    <p id="statusCipher">æœªè®¾ç½®</p>
                </div>
                <div class="auth-item">
                    <h4>åº—é“ºåç§°</h4>
                    <p id="statusShop">æœªè®¾ç½®</p>
                </div>
            </div>
        </div>

        <div class="navigation">
            <button class="btn btn-restart" onclick="restartAuth()">
                ğŸ”„ é‡æ–°æˆæƒ
            </button>
        </div>

        <div class="config-form">
            <h3>âš™ï¸ API é…ç½®</h3>
            <div class="form-group">
                <label>API Base URL</label>
                <input type="text" id="apiBaseUrl" value="http://192.168.5.153:3000">
            </div>
            <div class="form-group">
                <label>Access Token (ä»URLå‚æ•°è·å–)</label>
                <input type="text" id="accessToken" readonly>
            </div>
            <div class="form-group">
                <label>Shop Cipher (ä»URLå‚æ•°è·å–)</label>
                <input type="text" id="shopCipher" readonly>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('shop')">ğŸª åº—é“ºç®¡ç†</div>
            <div class="tab" onclick="switchTab('product')">ğŸ“¦ äº§å“ç®¡ç†</div>
            <div class="tab" onclick="switchTab('order')">ğŸ“‹ è®¢å•ç®¡ç†</div>
        </div>

        <!-- åº—é“ºç®¡ç† Tab -->
        <div class="tab-content active" id="shop-tab">
            <div class="response-area" id="shop-response">ç­‰å¾…APIå“åº”...</div>

            <div class="api-section">
                <h3>1. è·å–å·²æˆæƒçš„åº—é“ºåˆ—è¡¨</h3>
                <p>è·å–å½“å‰access_tokenæˆæƒçš„æ‰€æœ‰åº—é“º</p>
                <button class="btn-primary" onclick="getAuthorizedShops()">è·å–å·²æˆæƒåº—é“º</button>
            </div>

            <div class="api-section">
                <h3>2. è·å–åº—é“ºè¯¦ç»†ä¿¡æ¯</h3>
                <p>è·å–åº—é“ºçš„è¯¦ç»†ä¿¡æ¯å’ŒçŠ¶æ€</p>
                <button class="btn-primary" onclick="getShopDetails()">è·å–åº—é“ºè¯¦æƒ…</button>
            </div>

            <div class="api-section">
                <h3>3. è·å–åº—é“ºæƒé™</h3>
                <p>æŸ¥çœ‹åº”ç”¨å¯¹åº—é“ºçš„æƒé™åˆ—è¡¨</p>
                <button class="btn-primary" onclick="getShopPermissions()">è·å–åº—é“ºæƒé™</button>
            </div>

            <div class="api-section">
                <h3>4. è·å–Widget Token</h3>
                <p>è·å–ç”¨äºå‰ç«¯é›†æˆçš„Widget Token</p>
                <div class="input-group">
                    <input type="text" id="widgetShopId" placeholder="åº—é“ºIDï¼ˆå¯é€‰ï¼‰">
                    <button class="btn-primary" onclick="getWidgetToken()">è·å–Widget Token</button>
                </div>
            </div>
        </div>

        <!-- äº§å“ç®¡ç† Tab -->
        <div class="tab-content" id="product-tab">
            <div class="response-area" id="product-response">ç­‰å¾…APIå“åº”...</div>

            <div class="info-box">
                <h4>ğŸ“Œ ä½¿ç”¨è¯´æ˜</h4>
                <p>éœ€è¦å…ˆè·å–Access Tokenå’ŒShop Cipherã€‚æ‰€æœ‰äº§å“ç›¸å…³æ“ä½œéƒ½éœ€è¦è¿™ä¸¤ä¸ªå‚æ•°ã€‚</p>
            </div>

            <div class="api-section">
                <h3>1. æœç´¢äº§å“</h3>
                <p>æ ¹æ®æ¡ä»¶æœç´¢äº§å“ï¼Œæ”¯æŒåˆ†é¡µå’ŒçŠ¶æ€ç­›é€‰</p>
                <div class="button-group">
                    <button class="btn-primary" onclick="searchProducts()">æœç´¢æ‰€æœ‰äº§å“</button>
                    <button class="btn-success" onclick="searchProducts(4)">æœç´¢å·²æ¿€æ´»äº§å“</button>
                    <button class="btn-secondary" onclick="searchProducts(2)">æœç´¢è‰ç¨¿äº§å“</button>
                </div>
            </div>

            <div class="api-section">
                <h3>2. è·å–äº§å“è¯¦æƒ…</h3>
                <p>æ ¹æ®äº§å“IDè·å–è¯¦ç»†ä¿¡æ¯</p>
                <div class="input-group">
                    <input type="text" id="productId" placeholder="è¾“å…¥äº§å“ID">
                    <button class="btn-primary" onclick="getProductDetail()">è·å–äº§å“è¯¦æƒ…</button>
                </div>
            </div>

            <div class="api-section">
                <h3>3. åˆ›å»ºäº§å“</h3>
                <p>åˆ›å»ºæ–°äº§å“ï¼ˆéœ€è¦å®Œæ•´çš„äº§å“æ•°æ®JSONï¼‰</p>
                <textarea id="createProductData" placeholder='è¾“å…¥äº§å“JSONæ•°æ®'></textarea>
                <button class="btn-success" onclick="createProduct()">åˆ›å»ºäº§å“</button>
            </div>

            <div class="api-section">
                <h3>4. äº§å“ç®¡ç†æ“ä½œ</h3>
                <p>æ¿€æ´»ã€åœç”¨ã€åˆ é™¤äº§å“ï¼ˆè¾“å…¥äº§å“IDï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”ï¼‰</p>
                <div class="input-group">
                    <input type="text" id="manageProductIds" placeholder="äº§å“IDåˆ—è¡¨ï¼Œä¾‹å¦‚ï¼š123,456,789">
                </div>
                <div class="button-group">
                    <button class="btn-success" onclick="activateProducts()">æ¿€æ´»äº§å“ï¼ˆä¸Šæ¶ï¼‰</button>
                    <button class="btn-warning" onclick="deactivateProducts()">åœç”¨äº§å“ï¼ˆä¸‹æ¶ï¼‰</button>
                    <button class="btn-danger" onclick="deleteProducts()">åˆ é™¤äº§å“</button>
                </div>
            </div>

            <div class="api-section">
                <h3>5. æ›´æ–°åº“å­˜</h3>
                <p>æ›´æ–°äº§å“SKUçš„åº“å­˜æ•°é‡</p>
                <div class="input-group">
                    <input type="text" id="inventoryProductId" placeholder="äº§å“ID">
                    <input type="text" id="inventorySkuId" placeholder="SKU ID">
                    <input type="number" id="inventoryStock" placeholder="åº“å­˜æ•°é‡">
                    <button class="btn-primary" onclick="updateInventory()">æ›´æ–°åº“å­˜</button>
                </div>
            </div>

            <div class="api-section">
                <h3>6. æ›´æ–°ä»·æ ¼</h3>
                <p>æ›´æ–°äº§å“SKUçš„ä»·æ ¼</p>
                <div class="input-group">
                    <input type="text" id="priceProductId" placeholder="äº§å“ID">
                    <input type="text" id="priceSkuId" placeholder="SKU ID">
                    <input type="text" id="priceAmount" placeholder="ä»·æ ¼">
                    <button class="btn-primary" onclick="updatePrice()">æ›´æ–°ä»·æ ¼</button>
                </div>
            </div>

            <div class="api-section">
                <h3>7. è·å–åˆ†ç±»å’Œå“ç‰Œ</h3>
                <p>è·å–TikTok Shopçš„äº§å“åˆ†ç±»å’Œå“ç‰Œåˆ—è¡¨</p>
                <div class="button-group">
                    <button class="btn-primary" onclick="getCategories()">è·å–åˆ†ç±»åˆ—è¡¨</button>
                    <button class="btn-primary" onclick="getBrands()">è·å–å“ç‰Œåˆ—è¡¨</button>
                </div>
            </div>
        </div>

        <!-- è®¢å•ç®¡ç† Tab -->
        <div class="tab-content" id="order-tab">
            <div class="response-area" id="order-response">ç­‰å¾…APIå“åº”...</div>

            <div class="info-box">
                <h4>ğŸ“Œ ä½¿ç”¨è¯´æ˜</h4>
                <p>éœ€è¦å…ˆè·å–Access Tokenå’ŒShop Cipherã€‚å¯ä»¥æŒ‰çŠ¶æ€ç­›é€‰è®¢å•æˆ–æŒ‰æ—¶é—´èŒƒå›´æŸ¥è¯¢ã€‚</p>
            </div>

            <div class="api-section">
                <h3>1. æŒ‰çŠ¶æ€è·å–è®¢å•</h3>
                <p>å¿«é€Ÿè·å–ç‰¹å®šçŠ¶æ€çš„è®¢å•</p>
                <div class="button-group">
                    <button class="btn-warning" onclick="getPendingShipmentOrders()">å¾…å‘è´§è®¢å•</button>
                    <button class="btn-primary" onclick="getInTransitOrders()">è¿è¾“ä¸­è®¢å•</button>
                    <button class="btn-success" onclick="getCompletedOrders()">å·²å®Œæˆè®¢å•</button>
                </div>
            </div>

            <div class="api-section">
                <h3>2. è·å–è®¢å•è¯¦æƒ…</h3>
                <p>æ ¹æ®è®¢å•IDè·å–è¯¦ç»†ä¿¡æ¯</p>
                <div class="input-group">
                    <input type="text" id="orderId" placeholder="è¾“å…¥è®¢å•ID">
                    <button class="btn-primary" onclick="getOrderDetail()">è·å–è®¢å•è¯¦æƒ…</button>
                </div>
            </div>

            <div class="api-section">
                <h3>3. é«˜çº§æœç´¢è®¢å•</h3>
                <p>ä½¿ç”¨å®Œæ•´çš„æœç´¢æ¡ä»¶æŸ¥è¯¢è®¢å•</p>
                <textarea id="orderSearchData" placeholder='è¾“å…¥æœç´¢æ¡ä»¶JSON'></textarea>
                <button class="btn-primary" onclick="searchOrders()">æœç´¢è®¢å•</button>
            </div>

            <div class="api-section">
                <h3>4. è·å–æœ€è¿‘æ›´æ–°çš„è®¢å•</h3>
                <p>è·å–æœ€è¿‘Nåˆ†é’Ÿå†…æ›´æ–°çš„è®¢å•</p>
                <div class="input-group">
                    <input type="number" id="recentMinutes" placeholder="åˆ†é’Ÿæ•°" value="30">
                    <button class="btn-primary" onclick="getRecentlyUpdatedOrders()">è·å–æœ€è¿‘æ›´æ–°</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ä»URLå‚æ•°è·å–è®¤è¯ä¿¡æ¯
        function getUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            return {
                accessToken: urlParams.get('access_token'),
                shopCipher: urlParams.get('shop_cipher'),
                shopId: urlParams.get('shop_id'),
                shopName: urlParams.get('shop_name'),
                shopRegion: urlParams.get('shop_region')
            };
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatusDisplay() {
            const params = getUrlParams();

            if (params.accessToken) {
                const tokenPreview = params.accessToken.substring(0, 30) + '...';
                document.getElementById('statusToken').textContent = tokenPreview;
                document.getElementById('accessToken').value = params.accessToken;
            }

            if (params.shopCipher) {
                const cipherPreview = params.shopCipher.substring(0, 30) + '...';
                document.getElementById('statusCipher').textContent = cipherPreview;
                document.getElementById('shopCipher').value = params.shopCipher;
            }

            if (params.shopName) {
                document.getElementById('statusShop').textContent = params.shopName;
            }
        }

        function getBaseUrl() {
            return document.getElementById('apiBaseUrl').value.trim() || 'http://192.168.5.153:3000';
        }

        function getAccessToken() {
            return document.getElementById('accessToken').value.trim();
        }

        function getShopCipher() {
            return document.getElementById('shopCipher').value.trim();
        }

        function showResponse(tabId, data, error = false) {
            const responseArea = document.getElementById(tabId + '-response');
            const timestamp = new Date().toLocaleTimeString();
            const statusClass = error ? 'status-error' : 'status-success';
            const statusText = error ? 'ERROR' : 'SUCCESS';

            responseArea.innerHTML = `
                <div style="margin-bottom: 10px;">
                    <span class="status-badge ${statusClass}">${statusText}</span>
                    <span style="margin-left: 10px; color: #a0aec0;">${timestamp}</span>
                </div>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
        }

        async function makeRequest(url, options = {}) {
            try {
                const response = await fetch(url, options);
                const data = await response.json();
                return { data, error: !response.ok };
            } catch (error) {
                return { data: { error: error.message }, error: true };
            }
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        function restartAuth() {
            if (confirm('ç¡®å®šè¦é‡æ–°å¼€å§‹æˆæƒæµç¨‹å—ï¼Ÿå½“å‰è®¤è¯ä¿¡æ¯å°†ä¸¢å¤±ã€‚')) {
                window.location.href = 'index.html';
            }
        }

        // ========== åº—é“ºç®¡ç† ==========
        async function getAuthorizedShops() {
            const token = getAccessToken();
            if (!token) {
                alert('è¯·å…ˆå®Œæˆæˆæƒæµç¨‹');
                return;
            }

            const url = `${getBaseUrl()}/shops/authorized`;
            const { data, error } = await makeRequest(url, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            showResponse('shop', data, error);
        }

        async function getShopDetails() {
            const token = getAccessToken();
            if (!token) {
                alert('è¯·å…ˆå®Œæˆæˆæƒæµç¨‹');
                return;
            }

            const url = `${getBaseUrl()}/shops/details`;
            const { data, error } = await makeRequest(url, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            showResponse('shop', data, error);
        }

        async function getShopPermissions() {
            const token = getAccessToken();
            if (!token) {
                alert('è¯·å…ˆå®Œæˆæˆæƒæµç¨‹');
                return;
            }

            const url = `${getBaseUrl()}/shops/permissions`;
            const { data, error } = await makeRequest(url, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            showResponse('shop', data, error);
        }

        async function getWidgetToken() {
            const token = getAccessToken();
            const shopId = document.getElementById('widgetShopId').value.trim();

            if (!token) {
                alert('è¯·å…ˆå®Œæˆæˆæƒæµç¨‹');
                return;
            }

            const url = `${getBaseUrl()}/shops/widget-token${shopId ? '?shop_id=' + shopId : ''}`;
            const { data, error } = await makeRequest(url, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            showResponse('shop', data, error);
        }

        // ========== äº§å“ç®¡ç† ==========
        async function searchProducts(status) {
            const token = getAccessToken();
            const cipher = getShopCipher();

            if (!token || !cipher) {
                alert('è¯·å…ˆå®Œæˆæˆæƒæµç¨‹');
                return;
            }

            const searchData = {
                page_number: 1,
                page_size: 20
            };

            if (status) {
                searchData.search_status = status;
            }

            const url = `${getBaseUrl()}/products/search`;
            const { data, error } = await makeRequest(url, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'X-Shop-Cipher': cipher,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(searchData)
            });
            showResponse('product', data, error);
        }

        async function getProductDetail() {
            const token = getAccessToken();
            const cipher = getShopCipher();
            const productId = document.getElementById('productId').value.trim();

            if (!token || !cipher || !productId) {
                alert('è¯·å…ˆå®Œæˆæˆæƒæµç¨‹å¹¶è¾“å…¥äº§å“ID');
                return;
            }

            const url = `${getBaseUrl()}/products/${productId}`;
            const { data, error } = await makeRequest(url, {
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'X-Shop-Cipher': cipher
                }
            });
            showResponse('product', data, error);
        }

        async function createProduct() {
            const token = getAccessToken();
            const cipher = getShopCipher();
            const productDataStr = document.getElementById('createProductData').value.trim();

            if (!token || !cipher || !productDataStr) {
                alert('è¯·å…ˆå®Œæˆæˆæƒæµç¨‹å¹¶è¾“å…¥äº§å“æ•°æ®');
                return;
            }

            let productData;
            try {
                productData = JSON.parse(productDataStr);
            } catch (e) {
                alert('äº§å“æ•°æ®JSONæ ¼å¼é”™è¯¯');
                return;
            }

            const url = `${getBaseUrl()}/products`;
            const { data, error } = await makeRequest(url, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'X-Shop-Cipher': cipher,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(productData)
            });
            showResponse('product', data, error);
        }

        async function activateProducts() {
            await manageProducts('activate');
        }

        async function deactivateProducts() {
            await manageProducts('deactivate');
        }

        async function deleteProducts() {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™äº›äº§å“å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                return;
            }
            await manageProducts('delete');
        }

        async function manageProducts(action) {
            const token = getAccessToken();
            const cipher = getShopCipher();
            const productIdsStr = document.getElementById('manageProductIds').value.trim();

            if (!token || !cipher || !productIdsStr) {
                alert('è¯·å…ˆå®Œæˆæˆæƒæµç¨‹å¹¶è¾“å…¥äº§å“ID');
                return;
            }

            const productIds = productIdsStr.split(',').map(id => id.trim()).filter(id => id);

            let url, method;
            if (action === 'delete') {
                url = `${getBaseUrl()}/products`;
                method = 'DELETE';
            } else {
                url = `${getBaseUrl()}/products/${action}`;
                method = 'POST';
            }

            const { data, error } = await makeRequest(url, {
                method: method,
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'X-Shop-Cipher': cipher,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ product_ids: productIds })
            });
            showResponse('product', data, error);
        }

        async function updateInventory() {
            const token = getAccessToken();
            const cipher = getShopCipher();
            const productId = document.getElementById('inventoryProductId').value.trim();
            const skuId = document.getElementById('inventorySkuId').value.trim();
            const stock = document.getElementById('inventoryStock').value.trim();

            if (!token || !cipher || !productId || !skuId || !stock) {
                alert('è¯·å…ˆå®Œæˆæˆæƒæµç¨‹å¹¶å¡«å†™æ‰€æœ‰å­—æ®µ');
                return;
            }

            const url = `${getBaseUrl()}/products/${productId}/inventory`;
            const { data, error } = await makeRequest(url, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'X-Shop-Cipher': cipher,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    skus: [{ id: skuId, available_stock: parseInt(stock) }]
                })
            });
            showResponse('product', data, error);
        }

        async function updatePrice() {
            const token = getAccessToken();
            const cipher = getShopCipher();
            const productId = document.getElementById('priceProductId').value.trim();
            const skuId = document.getElementById('priceSkuId').value.trim();
            const amount = document.getElementById('priceAmount').value.trim();

            if (!token || !cipher || !productId || !skuId || !amount) {
                alert('è¯·å…ˆå®Œæˆæˆæƒæµç¨‹å¹¶å¡«å†™æ‰€æœ‰å­—æ®µ');
                return;
            }

            const url = `${getBaseUrl()}/products/${productId}/price`;
            const { data, error } = await makeRequest(url, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'X-Shop-Cipher': cipher,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    skus: [{ id: skuId, price: { amount: amount, currency: 'USD' } }]
                })
            });
            showResponse('product', data, error);
        }

        async function getCategories() {
            const token = getAccessToken();
            const cipher = getShopCipher();

            if (!token || !cipher) {
                alert('è¯·å…ˆå®Œæˆæˆæƒæµç¨‹');
                return;
            }

            const url = `${getBaseUrl()}/products/metadata/categories`;
            const { data, error } = await makeRequest(url, {
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'X-Shop-Cipher': cipher
                }
            });
            showResponse('product', data, error);
        }

        async function getBrands() {
            const token = getAccessToken();
            const cipher = getShopCipher();

            if (!token || !cipher) {
                alert('è¯·å…ˆå®Œæˆæˆæƒæµç¨‹');
                return;
            }

            const url = `${getBaseUrl()}/products/metadata/brands`;
            const { data, error } = await makeRequest(url, {
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'X-Shop-Cipher': cipher
                }
            });
            showResponse('product', data, error);
        }

        // ========== è®¢å•ç®¡ç† ==========
        async function getPendingShipmentOrders() {
            await getOrdersByStatus('pending-shipment');
        }

        async function getInTransitOrders() {
            await getOrdersByStatus('in-transit');
        }

        async function getCompletedOrders() {
            await getOrdersByStatus('completed');
        }

        async function getOrdersByStatus(status) {
            const token = getAccessToken();
            const cipher = getShopCipher();

            if (!token || !cipher) {
                alert('è¯·å…ˆå®Œæˆæˆæƒæµç¨‹');
                return;
            }

            const url = `${getBaseUrl()}/orders/status/${status}?page=1&page_size=20`;
            const { data, error } = await makeRequest(url, {
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'X-Shop-Cipher': cipher
                }
            });
            showResponse('order', data, error);
        }

        async function getOrderDetail() {
            const token = getAccessToken();
            const orderId = document.getElementById('orderId').value.trim();

            if (!token || !orderId) {
                alert('è¯·å…ˆå®Œæˆæˆæƒæµç¨‹å¹¶è¾“å…¥è®¢å•ID');
                return;
            }

            const url = `${getBaseUrl()}/orders/${orderId}`;
            const { data, error } = await makeRequest(url, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            showResponse('order', data, error);
        }

        async function searchOrders() {
            const token = getAccessToken();
            const searchDataStr = document.getElementById('orderSearchData').value.trim();

            if (!token || !searchDataStr) {
                alert('è¯·å…ˆå®Œæˆæˆæƒæµç¨‹å¹¶è¾“å…¥æœç´¢æ¡ä»¶');
                return;
            }

            let searchData;
            try {
                searchData = JSON.parse(searchDataStr);
            } catch (e) {
                alert('æœç´¢æ¡ä»¶JSONæ ¼å¼é”™è¯¯');
                return;
            }

            const url = `${getBaseUrl()}/orders/search`;
            const { data, error } = await makeRequest(url, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(searchData)
            });
            showResponse('order', data, error);
        }

        async function getRecentlyUpdatedOrders() {
            const token = getAccessToken();
            const cipher = getShopCipher();
            const minutes = document.getElementById('recentMinutes').value.trim() || '30';

            if (!token || !cipher) {
                alert('è¯·å…ˆå®Œæˆæˆæƒæµç¨‹');
                return;
            }

            const url = `${getBaseUrl()}/orders/filters/recently-updated?minutes=${minutes}`;
            const { data, error } = await makeRequest(url, {
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'X-Shop-Cipher': cipher
                }
            });
            showResponse('order', data, error);
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateStatusDisplay();

            // æ£€æŸ¥æ˜¯å¦æœ‰å¿…è¦çš„å‚æ•°
            const params = getUrlParams();
            if (!params.accessToken || !params.shopCipher) {
                alert('æœªæ£€æµ‹åˆ°æˆæƒä¿¡æ¯ï¼Œè¯·å…ˆå®Œæˆæˆæƒæµç¨‹');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
            }
        });
    </script>
</body>
</html>
